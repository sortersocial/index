<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>#{{ hashtag }} - Sorter</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/lists.css">
    <link rel="stylesheet" href="/static/css/votes.css">
    <link rel="stylesheet" href="/static/css/markdown.css">
</head>
<body>
    {% include "_github_corner.html" %}
    <div class="back-link">
        <a href="/">&larr; Back to index</a>
    </div>

    <h1>#{{ hashtag }}</h1>
    <p class="stats">
        {{ items|length }} items
        {% if vote_count is defined %}
        · {{ vote_count }} votes
        {% endif %}
    </p>

    <div class="action-buttons">
        <a href="mailto:about@mail.sorter.social?subject={{ ('Add to #' + hashtag)|urlencode }}&body={{ ('#' + hashtag + '\n-item-name { description }')|urlencode }}" class="button">
            Add Item
        </a>
        {% if items|length >= 2 %}
        <a href="mailto:about@mail.sorter.social?subject={{ ('Vote on #' + hashtag)|urlencode }}&body={{ ('#' + hashtag + '\n-' + items[0][0] + ' > -' + items[1][0] + ' { explanation }')|urlencode }}" class="button">
            Quick Vote
        </a>
        {% endif %}
    </div>

    {% if items %}
    <ol class="item-list">
        {% for title, record, rank_info in items %}
        <li>
            <div>
                <span class="item-rank">#{{ rank_info[0] }}</span>
                <span class="item-title">{{ title }}</span>
                <span style="color: #999; font-size: 0.9em; margin-left: 8px;">
                    (score: {{ "%.4f"|format(rank_info[1]) }})
                </span>
                {% if loop.index > 1 %}
                <a href="mailto:about@mail.sorter.social?subject={{ ('Vote on #' + hashtag)|urlencode }}&body={{ ('#' + hashtag + '\n-' + title + ' > -' + items[0][0] + ' { why ' + title + ' is better }')|urlencode }}" class="button-small">
                    Compare with #1
                </a>
                {% endif %}
            </div>
            {% if record.body %}
            <div class="item-body">{{ record.body|markdown }}</div>
            {% endif %}
            <div class="item-meta">
                {% if record.created_by %}
                Created by {{ record.created_by }}
                {% endif %}
                {% if record.timestamp %}
                · {{ record.timestamp|relative_time }}
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ol>
    {% else %}
    <p class="no-items">No items yet under this hashtag.</p>
    {% endif %}

    {% if votes %}
    <h2>Vote History</h2>
    <ul class="vote-list">
        {% for vote in votes %}
        <li class="vote-item">
            <div class="vote-comparison">
                <span class="vote-item-name">{{ vote.item1 }}</span>
                <span class="vote-arrow">→</span>
                <span class="vote-item-name">{{ vote.item2 }}</span>
            </div>
            <div class="vote-slider-container">
                {% set total = vote.ratio_left + vote.ratio_right %}
                {% set percentage = (vote.ratio_left / total * 100)|int %}
                <input 
                    type="range" 
                    min="0" 
                    max="100" 
                    value="{{ percentage }}" 
                    class="vote-slider"
                    disabled
                >
                <div class="vote-ratio">
                    {{ vote.ratio_left }}:{{ vote.ratio_right }}
                    ({{ vote.item1 }} {{ percentage }}% preferred)
                </div>
            </div>
            {% if vote.explanation %}
            <div class="vote-explanation">{{ vote.explanation|markdown }}</div>
            {% endif %}
            <div class="vote-meta">
                {% if vote.user_email %}
                by {{ vote.user_email }}
                {% endif %}
                {% if vote.timestamp %}
                · {{ vote.timestamp|relative_time }}
                {% endif %}
                {% if vote.attribute %}
                · attribute: {{ vote.attribute }}
                {% endif %}
                {% if vote.source_filename %}
                · <a href="/emails/{{ vote.source_filename }}" target="_blank">view email</a>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
</body>
</html>
